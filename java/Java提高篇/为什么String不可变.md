# 为什么string 是不可变的

## 一：字符串连接池

 Java设计者知道String将成为所有类型的Java应用程序中最常用的数据类型，这就是他们想要从一开始就优化的原因。在这个方向上的关键步骤之一是在字符串池中存储字符串文字的想法。目标是通过共享来减少临时String对象，并且为了共享，它们必须来自`Immutable类`。您不能与彼此不知道的两方共享可变对象。让我们假设一个例子，其中两个引用变量指向同一个String对象：

```java
String s1 =“Java”; 
String s2 =“Java”; 
```

  现在，如果s1将对象从“Java”更改为“C ++”，则引用变量也得到值s2 =“C ++”，它甚至都不知道它。通过使String不可变，可以共享String文本。简而言之，如果不在Java中使用String final或Immutable，则无法实现String池的关键思想。

----

## 二：为了安全
Java在每个服务级别提供安全的环境方面都有明确的目标，而String在整个安全性方面至关重要。String已广泛用作许多Java类的参数，例如，用于打开网络连接，您可以将主机和端口作为String传递，用于在Java中读取文件您可以将文件和目录的路径作为String传递，并且为了打开数据库连接，您可以将数据库URL作为String传递。如果String不是不可变的，则用户可能已授权访问系统中的特定文件，但在身份验证后，他可以将PATH更改为其他内容，这可能会导致严重的安全问题。同样，在连接到网络中的数据库或任何其他计算机时，突变字符串值可能会带来安全威胁。可变字符串也可能导致Reflection中的安全问题，因为参数是字符串。

----

## 三：在类加载机制中使用字符串
使字符串最终或不可变的另一个原因是它在类加载机制中被大量使用的事实。由于String不是不可变的，攻击者可以利用这一事实和加载标准Java类的请求，例如java.io.Reader可以更改为恶意类com.unknown.DataStolenReader。通过保持String final和immutable，我们至少可以确保JVM正在加载正确的类。

----

## 四：多线程优势
由于并发和多线程是Java的关键产品，因此考虑String对象的线程安全性非常有意义。由于预期String将被广泛使用，使其成为不可变意味着没有外部同步，意味着更清晰的代码涉及在多个线程之间共享String。这一单一功能使得复杂，混乱和容易出错的并发编码变得更加容易。因为String是不可变的，我们只是在线程之间共享它，它导致更可读的代码。

-----

## 五：优化和性能
现在，当你创建一个类Immutable时，你事先知道，这个类一旦创建就不会改变。这保证了许多性能优化的开放路径，例如缓存。字符串本身知道，我不会改变，所以String缓存其哈希码。它甚至懒惰地计算哈希码，一旦创建，只需缓存它。在简单的世界中，当您第一次调用任何String对象的hashCode（）方法时，它会计算哈希代码以及对hashCode（）的所有后续调用返回已计算的缓存值。这导致了良好的性能提升，因为String大量用于基于散列的映射，例如Hashtable和HashMap。如果不使用不可变和最终的，则无法缓存哈希码，因为它取决于String本身的内容。

---

## 六：字符串在Java中是不可变的或最终的优点和缺点
除了上述好处之外，由于String在Java中是最终的，因此还有一个优势可以计算。它是最常用的对象之一，可用作基于散列的集合中的关键字，例如HashMap和Hashtable。虽然不变性不是HashMap键的绝对必要条件，但使用Immutable对象作为键比使用可变对象要安全得多，因为如果在HashMap中驻留期间可变对象的状态发生了变化，那么它将无法将其检索回来，因为它是equals（）和hashCode（）方法取决于更改的属性。如果一个类是Immutable，当它存储在基于散列的集合中时，不存在改变其状态的风险。我已经强调的另一个重要好处是它的线程安全性。由于String是不可变的，因此您可以安全地在线程之间共享它，而无需担心外部同步。它使并发代码更易读，更不容易出错。

尽管具有所有这些优点，但Immutability也有一些缺点，例如它不会没有成本。由于String是不可变的，它会生成大量临时使用和抛出对象，这会给垃圾收集器带来压力。Java设计者已经考虑过它并在池中存储String文字是他们减少String垃圾的解决方案。它确实有帮助，但你必须小心创建String而不使用构造函数，例如new String（）不会从String池中选择对象。此外，平均而言，Java应用程序会产生太多垃 将字符串存储在池中也存在隐藏的风险。字符串池位于Java Heap的PermGen Space中，与Java Heap相比，它非常有限。拥有太多的字符串文字将很快填满这个空间，从而产生java.lang.OutOfMemoryError：PermGen Space。值得庆幸的是，Java语言程序员已经意识到这个问题，从Java 7开始，他们已经将String池移动到正常的堆空间，这比PermGen空间大得多。制作String final还有另一个缺点，因为它限制了它的可扩展性。现在，你只是不能扩展String以提供更多的功能，虽然它几乎不需要更常见的情况，但仍然是那些想要扩展java.lang.String类的人的限制。

这5个原因肯定会提示为什么String类已经在Java中成为Final和Immutable。当然，这是Java设计师的决定，但看起来上面的观点有助于他们做出这个决定。由于类似的原因，Integer，Long，Double和Float等包装类也是不可变的，最终的 .